# ATU实时监控器

这是一个简单的单一页面应用，用于实时显示电台设备的发射功率和驻波比（SWR），并通过自动天线调节器（ATU）的WebSocket接口获取数据。

## 功能特点

- **实时数据显示**：实时显示发射功率（W）和驻波比（SWR）
- **设备信息显示**：显示ATU设备型号、固件版本、网络模式、电感/电容值、存储位号等详细信息
- **状态指示**：可视化连接状态指示器（绿灯：已连接，红灯：未连接）
- **智能颜色编码**：
  - SWR值自动改变颜色（绿色≤1.5：良好，橙色1.5-2.0：中等，红色>2.0：过高）
  - 功率显示根据发射状态变化颜色
- **自动重连**：连接断开时自动尝试重连（最多5次）
- **故障恢复**：API不可用时自动使用模拟数据展示功能
- **现代界面**：毛玻璃效果的现代化设计，支持响应式布局

## 使用方法

1. **启动监控器**：
   ```bash
   # 启动HTTP服务器
   python3 -m http.server 8080
   ```

2. **访问页面**：
   打开浏览器访问：`http://localhost:8080/www/atu_realtime_monitor.html`

3. **自动连接**：
   页面加载后会自动尝试连接到ATU设备（默认：192.168.1.12:81）

4. **手动控制**：
   - 点击"连接设备"按钮手动连接
   - 点击"断开连接"按钮断开连接

## 设备配置

默认配置连接到：
- **IP地址**：192.168.1.12
- **端口**：81
- **协议**：WebSocket

如果需要修改设备地址，请编辑页面中的`deviceIp`和`devicePort`配置。

## 数据格式

### WebSocket二进制协议
ATU设备使用二进制协议：
- **Flag**：0xFF（标志字节）
- **Command**：0x01（电表数据命令）
- **SWR**：2字节小端序整数（如果≥100，则除以100转换为浮点数）
- **Forward Power**：2字节小端序整数（瓦特）
- **Max Forward Power**：2字节小端序整数（瓦特）

### 设备信息API
设备还提供HTTP API获取详细信息：
```json
{
  "model": "ATR-1000",
  "version": "v0.9.30b",
  "networkMode": "LC",
  "inductance": "0uH",
  "capacitance": "80pF",
  "memorySlot": "01"
}
```

## SWR颜色指示

- **绿色**（≤1.5）：SWR正常，天线匹配良好
- **橙色**（1.5-2.0）：SWR中等，需要注意
- **红色**（>2.0）：SWR过高，建议检查天线

## 故障排除

### 连接问题诊断

如果ATU数据没有有效获取，请按以下步骤诊断：

1. **使用诊断工具**：
   访问 `http://localhost:8080/atu_diagnostic.html`
   - 点击"测试HTTP连接"检查基本连接
   - 点击"测试WebSocket连接"检查实时数据连接
   - 点击"开始监控"进行持续测试

2. **检查设备状态**：
   - 确认ATU设备（192.168.1.12）已开机
   - 确认设备正在发送电台信号（没有信号时显示为0）
   - 检查设备Web界面是否正常访问

3. **网络连接**：
   - 确认电脑和ATU设备在同一网络
   - 检查防火墙是否阻止8081端口（WebSocket端口）
   - 尝试ping设备IP地址

4. **数据协议**：
   - ATU设备使用二进制WebSocket协议
   - 实时监控器会自动发送同步命令（0xFF 0x00）
   - 电表数据命令为0x01，包含功率和SWR信息

### 访问方式

**主要监控器**：`http://localhost:8080/atu_realtime_monitor.html`
**诊断工具**：`http://localhost:8080/atu_diagnostic.html`
**演示页面**：`http://localhost:8080/atu_monitor_demo.html`

### 调试功能

新的监控器包含详细的调试日志，可以帮助诊断问题：
- 查看浏览器开发者工具的Console
- 检查页面底部的调试信息面板
- 使用诊断工具进行逐步测试

## 技术实现

- **前端技术**：纯HTML/CSS/JavaScript，无需额外依赖
- **通信协议**：
  - WebSocket二进制协议（实时功率和SWR数据）
  - HTTP RESTful API（设备信息获取）
- **数据解析**：
  - 使用DataView处理二进制数据
  - JSON解析设备信息
  - 智能容错和数据模拟
- **界面设计**：
  - 现代毛玻璃效果设计
  - 响应式网格布局
  - 智能颜色状态指示
  - 平滑动画过渡效果

## 文件结构

```
www/
└── atu_realtime_monitor.html    # 主页面文件
```

这是一个独立的单一页面应用，可以直接部署到任何支持静态文件的Web服务器上。
