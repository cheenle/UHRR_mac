<html>
	<head>
		<meta charset="UTF-8">
		<title>Universal Hamradio Remote by F4HTB</title>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	</head>
	<body onload="bodyload();">
	
		<a href="#fermer" id="ombre-body"></a>
		<div id="pop-upspinner"> 
                <img alt="" src="img/spinner.gif"> 
				<p  id="socketsate"><center>Wait For connection....</center></p>
        </div>
	
		<div id="div-princ">
			<img onclick="powertogle();" id="button_power" alt="Click to connect or disconnect interface" src="img/poweroff.png">
			
			<form id="RX-GAIN_control">
				AF GAIN:<input oninput="AudioRX_SetGAIN();setCookie('C_af', this.value, 180);" onchange="AudioRX_SetGAIN();setCookie('C_af', this.value, 180);" value="250" step="5" type="range" id="C_af" name="volume" min="0" max="1000">
			</form>
			
			<div id="Rxmeters">
				<div id="Rxinstant">
					<div class="label">RX volume:</div>
					<meter low="10" high="70" max="100" value="0"></meter>
					<div class="value"></div>
				</div>
			</div>
			
			<form id="TX-GAIN_control">
				MIC GAIN:<input oninput="AudioTX_SetGAIN(this.value/100);setCookie('C_mg', this.value, 180);" onchange="AudioTX_SetGAIN(this.value/100);setCookie('C_mg', this.value, 180);" value="50" step="5" type="range" id="C_mg" name="volume" min="0" max="200">
			</form>
			
			<div id="Txmeters">
				<div id="Txinstant">
					<div class="label">TX volume:</div>
					<meter low="10" high="50" max="100" value="0"></meter>
					<div class="value"></div>
				</div>
			</div>
			
			<div id="div-freq">
				<ul id="freq_but">
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="cmhz" v=100000000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dmhz" v=10000000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="umhz" v=1000000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();"> </li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="ckhz" v=100000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dkhz" v=10000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="ukhz" v=1000>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();"> </li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="chz" v=100>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dhz" v=10>â–²</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="uhz" v=1>â–²</li>
				</ul>
				<ul ondblclick="changeinputfreqstyle(event);document.getElementById('freq_disp_input_text').focus();document.getElementById('freq_disp_input_text').select();" id="freq_disp" onwheel="freq_digit_scroll()">
				  <input onkeypress="changeinputfreqstyle(event);" onkeydown="validateNumber(event);"/  id="freq_disp_input_text" type="text" minlength="4" maxlength="8" size="10">
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="cmhz" v=100000000>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="dmhz" v=10000000>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="umhz" v=1000000>0</li>
				  <li class="freq_digit">.</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="ckhz" v=100000>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="dkhz" v=10000>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="ukhz" v=1000>0</li>
				  <li class="freq_digit">.</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="chz" v=100>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="dhz" v=10>0</li>
				  <li class="freq_digit" onmouseenter="select_digit();" onmouseleave="clear_select_digit();" id="uhz" v=1>0</li>
				</ul>
				<ul id="freq_but">
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="cmhz" v=-100000000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dmhz" v=-10000000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="umhz" v=-1000000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();"> </li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="ckhz" v=-100000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dkhz" v=-10000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="ukhz" v=-1000>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" > </li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="chz" v=-100>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="dhz" v=-10>â–¼</li>
				  <li onmousedown="button_pressed();rotatefreq();" onmouseup="button_unpressed();" class="button_unpressed" digit="uhz" v=-1>â–¼</li>
				</ul>
			</div>
			
			<div id="div-bandshortcut">
				<ul id="band_but">
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="001845500">160m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="003850000">80m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="007050000">40m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="010140000">30m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="014270000">20m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="018132500">17m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="021400000">15m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="027085000">11m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="024952500">12m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="028450000">10m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="050202500">6m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="070202500">4m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="144300000">2m</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="432200000">70cm</li>
				  <li onmousedown="button_pressed();recall_hambands();" onmouseup="button_unpressed();" class="button_unpressed" v="010000000">WWW</li>
				</ul>
			</div>
			
			<div id="div-filtershortcut">
				<ul id="band_but">
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_pressed" lichecked="" fq="0" fg="0" ft="highshelf" frq="22000">None</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="0" fg="-20" ft="highshelf" frq="4400">LP 4.4k</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="0" fg="-20" ft="highshelf" frq="3300">LP 3.3k</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="0" fg="-20" ft="highshelf" frq="2700">LP 2.7k</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="0" fg="-20" ft="highshelf" frq="2100">LP 2.1k</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="0" fg="-20" ft="highshelf" frq="1000">LP 1.0k</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="50" fg="-100" ft="bandpass" frq="300">BP 300Hz</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="50" fg="-100" ft="bandpass" frq="500">BP 500Hz</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="50" fg="-100" ft="bandpass" frq="800">BP 800Hz</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" fq="50" fg="-100" ft="bandpass" frq="1000">BP 1kHz</li>
				  <li onclick="if(poweron)togle_li();setaudiofilter();" class="button_unpressed" id="custom_filter_click" fq="0" fg="0" ft="highshelf" frq="22000">BP click</li>
				  <li onclick="if(poweron)togle_li();document.getElementById('div-customfilter').style.display = 'block';" class="button_unpressed" fq="0" fg="0" ft="highshelf" frq="22000">Custom</li>
				</ul>
			</div>
			
			<div id="div-customfilter">
				filter_type:<select id="customfilter_T">
					<option >--Please choose a filter type--</option>
					<option value="lowpass">lowpass</option>
					<option value="highpass">highpass</option>
					<option value="bandpass">bandpass</option>
					<option value="lowshelf">lowshelf</option>
					<option value="highshelf">highshelf</option>
					<option value="peaking">peaking</option>
					<option value="notch">notch</option>
					<option value="allpass">allpass</option>
				</select><br>
				Freq:<input type="text" id="customfilter_F" value="click to FFT to set">hz<br>
				Q Factor:<input type ="text" id="customfilter_Q" value="50"><br>
				Gain:<input type ="text" id="customfilter_G" value="50"><br>
				<input value="ok" type ="button" onclick="document.getElementById('div-customfilter').style.display = 'none';setcustomaudiofilter();">
			</div>
			
			
			<form id="SQUELCH_control">
				SQL:<input oninput="if(poweron)drawRXSmeter();setCookie('SQUELCH', this.value, 180);" onchange="if(poweron)drawRXSmeter();setCookie('SQUELCH', this.value, 180);" value="0" step="5" type="range" id="SQUELCH" name="SQUELCH" min="0" max="100">
			</form>			
			
			<form id="personalfrequency">
			  <label>Personal Freqs</label>
			  <select id="selectpersonalfrequency">
			  </select>
			  <label onclick="recall_freqfromcokkies();">recall</label>
			  <label onclick="delete_freqfromcokkies();">&nbsp;delete</label>
			  <label onclick="save_freqtocokkies();">&nbsp;save</label>
			</form>
			
			<canvas class="visualizer" id="canBFSPC" width="1024" ></canvas>
			<canvas class="visualizer" id="canBFFFT" width="2048" ></canvas>
			<input class="slider-wrapper slider-wrapper_floor" value="0" step="5" type="range" id="canBFFFT_scale_floor" min="-100" max="100">
			<input class="slider-wrapper slider-wrapper_multdb" value="0" step="5" type="range" id="canBFFFT_scale_multdb" min="-100" max="100">
			<input class="slider-wrapper slider-wrapper_start" value="0" step="5" type="range" id="canBFFFT_scale_start" min="-200" max="200">
			<input class="slider-wrapper slider-wrapper_multhz" value="0" step="5" type="range" id="canBFFFT_scale_multhz" min="-200" max="200">
			<label id="canvasBFFFT_coord"></label>
			
			<label id="callsign"></label>
			
			<div id="div-conf"><a href="/CONFIG" target="_UHRRconfig"><img src="img/config.png"></a></div>
			<div id="div-panfft"><a onclick="panfft = window.open( this.href, 'UHRRpanfft', 'width=1000, height=1000, menubar=no, toolbar=no, location=no, resizable=yes, scrollbars=no, status=no, dependent=yes'); return false;" href="/panfft.html" target="_UHRRpanfft"><img src="img/panfft.png"></a></div>
			
			<canvas id="canRXsmeter" width=250 height=50 ></canvas>
			
			<div id="div-smeterdigitRX">S9+40dB</div>
						<div id="div-mode_menu">
				<ul>
				  <li onclick="togle_li();sendTRXmode();" class="button_mode button_pressed" lichecked="">USB</li>
				  <li onclick="togle_li();sendTRXmode();" class="button_mode button_unpressed">LSB</li>
				  <li onclick="togle_li();sendTRXmode();" class="button_mode button_unpressed">CW</li>
				  <li onclick="togle_li();sendTRXmode();" class="button_mode button_unpressed">AM</li>
				  <li onclick="togle_li();sendTRXmode();" class="button_mode button_unpressed">FM</li>
				</ul>
			</div>
			
			<div id="div-TX">
				<span class="button_unpressed" id="TX-record">TX</span>	
				<span onclick="TXtogle();" class="button_unpressed" id="TX-record-lock">TX Lock</span>
				<div id="ptt-status-indicator" style="display: inline-block; margin-left: 10px; color: #ff4444; font-weight: bold;">PTT: OFF</div>
				<form id="TX-record_record_opus">
					<input type="checkbox" id="encode" class=none alt="Encode TX with opus codec">Encode TX</input><br>
				</form>
			</div>
			
			<!-- åŠŸç‡å’ŒSWRæ˜¾ç¤º -->
			<div id="div-power-swr" style="display: flex; gap: 20px; margin-top: 10px; align-items: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
				<div id="power-display" style="text-align: center;">
					<div style="font-size: 12px; color: #aaa;">åŠŸç‡</div>
					<div id="power-value" style="font-size: 26px; font-weight: bold; color: #4CAF50;">-- W</div>
				</div>
				<div id="swr-display" style="text-align: center;">
					<div style="font-size: 12px; color: #aaa;">é©»æ³¢æ¯”</div>
					<div id="swr-value" style="font-size: 26px; font-weight: bold; color: #2196F3;">--</div>
				</div>
				<div id="efficiency-display" style="text-align: center;">
					<div style="font-size: 12px; color: #aaa;">æ•ˆç‡</div>
					<div id="efficiency-value" style="font-size: 26px; font-weight: bold; color: #FF9800;">-- %</div>
				</div>
			</div>
			
			<!-- ATUæ§åˆ¶æŒ‰é’® -->
			<div id="div-atu-controls" style="display: flex; gap: 10px; margin-top: 10px; align-items: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
				<button id="atu-tune-btn" style="padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">ATUè°ƒè°</button>
				<button id="atu-bypass-btn" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">ATUç›´é€š</button>
				<button id="atu-reset-btn" style="padding: 8px 16px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer;">ATUé‡ç½®</button>
				<button id="atu-autotune-toggle" style="padding: 8px 16px; background: #9C27B0; color: white; border: none; border-radius: 4px; cursor: pointer;">è‡ªåŠ¨è°ƒè°: OFF</button>
			</div>
			
			<div id="div-scoketscontrols">
				<p id="indwsAudioTX"><img src="img/critsred.png">wsTX</p>
				<p id="indwsAudioRX"><img src="img/critsred.png">wsRX</p>
				<p id="indwsControlTRX"><img src="img/critsred.png">wsCtrl</p>
			</div>
			
			<div id="div-latencymeter">latency:âˆ</div>
			<div id="div-bitrates">bitrate RX: 0.0 kbps | TX: 0.0 kbps</div>
			
		</div>	
		
		<script src="controls.js"></script>
		<script src="tx_button_optimized.js"></script>
		<script src="atu.js"></script>
		<script src="atu_autotune.js"></script>
		<script src="atu_test.js"></script>
		
		<script>
			// æ·»åŠ ATUæ§åˆ¶æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
			document.addEventListener('DOMContentLoaded', function() {
				// ATUè°ƒè°æŒ‰é’®
				const tuneBtn = document.getElementById('atu-tune-btn');
				if (tuneBtn) {
					tuneBtn.addEventListener('click', function() {
						if (typeof atuTester !== 'undefined' && atuTester && atuTester.isConnected) {
							atuTester.startFullTune();
						} else if (typeof atuSocket !== 'undefined' && atuSocket && atuSocket.readyState === WebSocket.OPEN) {
							// å‘é€å®Œæ•´è°ƒè°å‘½ä»¤
							const tuneCommand = {
								type: 'command',
								command: 'tune_mode',
								value: 2 // 2 = å®Œæ•´è°ƒè°
							};
							atuSocket.send(JSON.stringify(tuneCommand));
							
							// å‘é€è°ƒè°çŠ¶æ€å‘½ä»¤
							const statusCommand = {
								type: 'command',
								command: 'tune_status',
								value: 1 // 1 = è°ƒè°çŠ¶æ€
							};
							atuSocket.send(JSON.stringify(statusCommand));
							
							console.log('ğŸ“¤ å‘é€ATUè°ƒè°å‘½ä»¤');
						} else {
							console.log('âŒ ATUæœªè¿æ¥');
						}
					});
				}
				
				// ATUç›´é€šæŒ‰é’®
				const bypassBtn = document.getElementById('atu-bypass-btn');
				if (bypassBtn) {
					bypassBtn.addEventListener('click', function() {
						if (typeof atuTester !== 'undefined' && atuTester && atuTester.isConnected) {
							atuTester.setBypass();
						} else if (typeof atuSocket !== 'undefined' && atuSocket && atuSocket.readyState === WebSocket.OPEN) {
							// å‘é€ç›´é€šçŠ¶æ€å‘½ä»¤
							const statusCommand = {
								type: 'command',
								command: 'tune_status',
								value: 0 // 0 = ç›´é€šçŠ¶æ€
							};
							atuSocket.send(JSON.stringify(statusCommand));
							
							console.log('ğŸ“¤ å‘é€ATUç›´é€šå‘½ä»¤');
						} else {
							console.log('âŒ ATUæœªè¿æ¥');
						}
					});
				}
				
				// ATUé‡ç½®æŒ‰é’®
				const resetBtn = document.getElementById('atu-reset-btn');
				if (resetBtn) {
					resetBtn.addEventListener('click', function() {
						if (typeof atuTester !== 'undefined' && atuTester && atuTester.isConnected) {
							atuTester.setTuneMode(0); // é‡ç½®æ¨¡å¼
						} else if (typeof atuSocket !== 'undefined' && atuSocket && atuSocket.readyState === WebSocket.OPEN) {
							// å‘é€é‡ç½®å‘½ä»¤
							const resetCommand = {
								type: 'command',
								command: 'tune_mode',
								value: 0 // 0 = é‡ç½®
							};
							atuSocket.send(JSON.stringify(resetCommand));
							
							console.log('ğŸ“¤ å‘é€ATUé‡ç½®å‘½ä»¤');
						} else {
							console.log('âŒ ATUæœªè¿æ¥');
						}
					});
				}
				
				// è‡ªåŠ¨è°ƒè°åˆ‡æ¢æŒ‰é’®
				const autotuneToggle = document.getElementById('atu-autotune-toggle');
				if (autotuneToggle) {
					autotuneToggle.addEventListener('click', function() {
						if (typeof atuAutoTune !== 'undefined') {
							if (atuAutoTune.isEnabled) {
								atuAutoTune.disable();
								autotuneToggle.textContent = 'è‡ªåŠ¨è°ƒè°: OFF';
								autotuneToggle.style.background = '#9C27B0';
							} else {
								atuAutoTune.enable();
								autotuneToggle.textContent = 'è‡ªåŠ¨è°ƒè°: ON';
								autotuneToggle.style.background = '#4CAF50';
							}
						}
					});
				}
				
				// å¦‚æœatuTesterå¯ç”¨ï¼Œå°è¯•è¿æ¥
				if (typeof atuTester !== 'undefined') {
					// å»¶è¿Ÿè¿æ¥ä»¥ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨
					setTimeout(() => {
						atuTester.connect();
					}, 2000);
				}
				
				// å¦‚æœATUæ˜¾ç¤ºç³»ç»Ÿå¯ç”¨ï¼Œåˆå§‹åŒ–å®ƒ
				if (typeof initAtuDisplay !== 'undefined') {
					// å°½æ—©åˆå§‹åŒ–ATUæ˜¾ç¤ºä»¥ç¡®ä¿åœ¨ç”¨æˆ·æ“ä½œå‰å‡†å¤‡å¥½
					initAtuDisplay();
				}
			});
		</script>
	</body>
</html>
