# ATU设备诊断指南

## 问题分析

从您提供的界面显示来看，ATU诊断工具显示：
- HTTP状态: 未测试
- WebSocket状态: 未连接
- 实时数据: 显示默认值（-- W, --, -- W）

这表明存在连接问题。根据网络测试结果：

### 🔍 诊断结果

1. **ATU设备在线** ✅
   - IP地址 `192.168.1.12` 可达
   - 平均延迟约68ms

2. **端口状态** ⚠️
   - HTTP端口 80: ✅ 开放（返回200 OK）
   - WebSocket端口 81: ❌ 被拒绝

## 🚨 问题原因

**主要问题**：WebSocket端口81连接被拒绝

可能的原因：
1. **端口配置错误**：ATU设备可能使用不同的端口
2. **服务未启动**：ATU设备的WebSocket服务未运行
3. **防火墙阻止**：防火墙阻止了端口81的连接
4. **需要激活**：可能需要先访问Web界面激活WebSocket服务

## 🔧 解决方案

### 第一步：端口扫描
访问增强版的诊断工具：`http://localhost:8080/atu_diagnostic.html`

1. 在诊断工具中点击 **"扫描端口"** 按钮
2. 工具会自动扫描常见端口（80, 81, 8080, 8081等）
3. 查看哪些端口显示为"开放"

### 第二步：手动端口测试
如果端口扫描发现其他端口开放：

1. 在诊断工具的端口输入框中修改端口号
2. 点击 **"测试HTTP连接"** 和 **"测试WebSocket连接"**
3. 查看连接状态

### 第三步：激活WebSocket服务
有些ATU设备需要先访问Web界面才能激活WebSocket服务：

1. 在浏览器中访问：`http://192.168.1.12/`
2. 浏览ATU设备的Web界面
3. 然后再测试WebSocket连接

### 第四步：常见端口尝试
如果端口81不可用，请尝试以下端口：
- **80**：标准HTTP端口（已确认开放）
- **8080**：常用WebSocket端口
- **8081**：备选WebSocket端口
- **81**：当前配置（被拒绝）

## 📊 诊断工具使用方法

### 访问诊断工具
```
http://localhost:8080/atu_diagnostic.html
```

### 功能说明
1. **端口配置**：可以修改IP地址和端口号
2. **端口扫描**：自动检测开放的端口
3. **连接测试**：
   - 测试HTTP连接（端口80等）
   - 测试WebSocket连接（实时数据端口）
4. **实时监控**：持续监控数据流
5. **调试日志**：详细显示连接和数据处理过程

### 界面元素
- 🟢 **绿色指示器**：连接成功
- 🔴 **红色指示器**：连接失败
- 📊 **实时数据**：显示功率和SWR值
- 📝 **调试日志**：技术细节和错误信息

## 🔍 故障排除步骤

### 1. 检查设备Web界面
```bash
# 在浏览器中访问
http://192.168.1.12/
```

确认ATU设备的Web界面可以正常访问。

### 2. 检查设备设置
在ATU设备的Web界面中查找：
- WebSocket或实时数据设置
- 端口配置选项
- 网络设置

### 3. 尝试不同端口
如果端口81不可用，尝试：
- 访问设备Web界面查看实际端口
- 询问设备制造商推荐的端口号
- 查看设备说明书

### 4. 网络环境检查
- 确认电脑和ATU设备在同一网络
- 检查路由器设置
- 尝试重启ATU设备和路由器

## 📞 如果问题依然存在

如果按照上述步骤仍无法连接，请提供：

1. **ATU设备型号**：确认确切的设备型号
2. **设备固件版本**：在设备Web界面中查看
3. **网络拓扑**：电脑和ATU设备的连接方式
4. **错误日志**：诊断工具中的详细错误信息

## 💡 备用方案

如果WebSocket连接一直失败，可以考虑：

1. **使用HTTP轮询**：定期通过HTTP请求获取数据
2. **串口连接**：如果设备支持串口通信
3. **MQTT或其他协议**：查看设备是否支持其他通信协议

请先尝试端口扫描功能，这通常能帮助找到正确的端口配置。
