<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ATR-1000 Dashboard v1.0</title><style>body {-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;font-family: Arial, sans-serif;margin: 0;padding: 0;background-color: #F1F3F5;display: flex;align-items: center;height: 100vh;box-sizing: border-box;flex-direction: column;}.status-dot {padding: 6px;border-radius: 15px;color: white;background-color: #E84026;margin-right: 10px;position: absolute;top: 10px;left: 20px;}.status-sync{padding:6px;position: absolute;top:10px;right:10px;font-size:30px;color:#317AF7;cursor: pointer;}.title {font-size: 2em;color: #317AF7;text-shadow: 2px 2px 10px rgba(0, 154, 214, 0.2);margin-top: 10px;margin-bottom: 5px;margin-left: 40px;}.h1 {font-size: 3em;}select {font-size: 1em;;}textarea {border: 0;}.index {width: 98%;}.panle {width: 100%;display: none;}.dashborad {text-align: center;width: 100%;max-width: 360px;margin: 10px auto;background: white;padding: 20px;border-radius: 15px;box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);box-sizing: border-box;}.cards {display: flex;justify-content: space-between;border-radius: 15px;overflow: hidden;}.cards_item {text-align: center;width: 50%;background-color: #ffffff;box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);transition: background-color 0.3s;}.cards_item span {display: block;font-size: 1.2em;color: #888;margin-bottom: 10px;}.cards_item div {font-size: 1.8em;font-weight: bold;color: #333;}.button {background-color: #5291FF;color: white;border: none;font-size: 1.2em;border-radius: 5px;cursor: pointer;min-width: 51%;min-height: 40px;transition: background-color 0.3s;margin-top: 15px;}.button:hover {background-color: #4178d4;}.modal {display: none;position: fixed;width: 100%;height: 100%;background-color: white;border-radius: 15px;z-index: 100;padding: 20px 10px 90px 10px;overflow-y: auto;box-sizing: border-box;}.modal-content {display: flex;flex-wrap: wrap;gap: 10px;justify-content: center;}.memory-button {width: 45%;height: 60px;background-color: #F1F3F5;color: #777;font-size: 1em;font-weight: bold;border: none;border-radius: 10px;cursor: pointer;transition: background-color 0.3s;}.memory-button .info {font-size: 0.8em;}.active {color: white;background-color: #0A59F7;}.close-button {position: fixed;bottom: 5%;left: 50%;width: 50%;transform: translateX(-50%);background-color: #0A59F7;color: white;border: none;padding: 10px 20px;font-size: 1em;border-radius: 5px;cursor: pointer;}#version {font-size: 0.5em;margin-left: 10px;/* color:#999; *//* text-shadow: 2px 2px 2px rgba(0, 154, 214, 0.2); */}.bubble {position: fixed;z-index: 1000;bottom: -100px;left: 50%;transform: translateX(-50%);background-color: rgba(0, 0, 0, 0.7);color: white;padding: 10px;border-radius: 5px;font-size: 1.2em;opacity: 0;transition: opacity 0.5s ease;}.bubble.show {bottom: 10%;opacity: 1;}.action {width: 100%;}.action .cards {justify-content: center;}.action button {display: block;text-align: center;padding: 10px 20px;font-size: 2em;width: 100%;border: 0;background-color: #F1F3F5;color: #999;cursor: pointer;box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);transition: background-color 0.3s;}.action .cards button:first-child {border-radius: 15px 0 0 15px;}.action .cards button:last-child {border-radius: 0 15px 15px 0;}.action .active {color: white;background-color: #0A59F7;}@media (min-width: 1000px) {.meter,.action {width: 100%;display: flex;justify-content: space-between;flex-direction: row;margin-bottom: 20px;}.dashborad {max-width: 48%;}.cards_item .h1 {font-size: 5em}.cards_item .h2 {font-size: 3em}.memory-button {width: 300px;height: 100px;font-size: 1.5em;}.memory-button .info {font-size: 1.2em;}}.config_item .caption {font-size: 2em;font-weight: bold;color: #0A59F7;}input {padding: 5px;border: 1px solid #d6d6d6;border-radius: 10px;font-size: 1em;}label {text-align: right;width: 80px;display: inline-block;}#firmware_desc {width: 50%;height: 150px;margin-top: 10px;}.statics {color: #999;}</style></head><body><div><div class="status-dot" id="statusDot">离线</div><div class="title">ATR-1000<span id="version"></span></div><div class="status-sync" id="syncRefresh" onclick="sync();">&#x21bb;</div></div><div class="index panle" style="display: block;"><div class="meter"><div class="dashborad"><div class="cards"><div class="cards_item"><span>功率</span><div class="h1" id="fwdValue">-</div></div><div class="cards_item"><span>驻波</span><div class="h1" id="swrValue">-</div></div></div></div><div class="dashborad"><div class="cards"><div class="cards_item" onclick="openModal();"><span>存储位号&#128221;</span><div class="h1" id="memoryId">-</div></div><div class="cards_item" onclick="showPage(3);"><span>频率名称&#128221;</span><div class="h1" id="memoryFreq">-</div></div></div></div><div class="dashborad"><div class="cards"><div class="cards_item"><span>网络</span><div class="h2" id="swValue">-</div><button class="button" onclick="ws.setRelayButton('S',0);">LC</button><button class="button" onclick="ws.setRelayButton('S',1);">CL</button></div><div class="cards_item"><span>电感值</span><div class="h2" id="indValue">-</div><button class="button" onclick="ws.setRelayButton('L',+1);">+</button><button class="button" onclick="ws.setRelayButton('L',-1);">-</button></div><div class="cards_item"><span>电容值</span><div class="h2" id="capValue">-</div><button class="button" onclick="ws.setRelayButton('C',+1);">+</button><button class="button" onclick="ws.setRelayButton('C',-1);">-</button></div></div></div></div><div class="action"><div class="dashborad"><div id="tuneStatus" class="cards"><button onclick="ws.setTune(0);">信号<br />直通</button><button onclick="ws.setTune(1);">调谐<br />状态</button></div></div><div class="dashborad"><div id="tuneMode" class="cards"><button onclick="ws.setTuneMode(0);">重置<br />状态</button><button onclick="ws.setTuneMode(1);">内存<br />调谐</button><button onclick="ws.setTuneMode(2);">完整<br />调谐</button></div></div><div class="dashborad"><div id="tuneMode" class="cards"><button onclick="openModal();">存储<br />选择</button><button onclick="ws.setMemoryId(memoryID);">撤销<br />更改</button><button onclick="ws.setActionMemory(1)">保存<br />存储</button></div></div><div class="dashborad"><div id="remoteMode" class="cards"><button onclick="ws.setWifiReset();">重启<br />网络</button><button onclick="getRouteList();showPage(1);">参数<br />配置</button><button onclick="getFirmware();showPage(2);">系统<br />升级</button></div></div></div></div><div class="config panle"><div class="dashborad config_item"><div class="caption">本设备热点配置</div><div><label>热点名称</label><input id="apName" type="text" value="" maxlength="20" minlength="1" pattern="[^a-zA-Z]+" requireddisabled /></div><div><label>密码</label><input id="apPass" type="text" value="" maxlength="20" minlength="8" pattern="[^a-zA-Z]+" required /></div><div class="caption">连接路由配置</div><div><label>路由名称</label><input id="routeName" type="text" value="" maxlength="20" minlength="1" pattern="[^a-zA-Z]+"list="routeList" /><datalist id="routeList"></datalist></div><div><label>密码</label><input id="routePass" type="text" value="" maxlength="20" minlength="8" pattern="[^a-zA-Z]+" /></div><button onclick="ws.setWifi();showPage(0);" class="button">保存</button><button onclick="showPage(0);" class="button">关闭</button></div><div class="dashborad config_item"><div class="caption">存储位数据</div><button onclick="saveMemoryJson()" class="button">导出备份</button><button onclick="resumeMemoryJson()" class="button">导入还原</button><button onclick="showPage(0);" class="button">关闭</button></div></div><div class="update panle"><div class="dashborad config_item"><div class="caption">互联网在线固件</div><div><label>选择文件</label><select id="firmware_online"></select><br /><textarea id="firmware_desc"></textarea></div><button onclick="uploadFirmware(0);" class="button">升级</button></div><div class="dashborad config_item"><div class="caption">本地固件文件</div><div><label>选择文件</label><input type='file' id='firmware_file' accept=".hex"></div><button onclick="uploadFirmware(1);" class="button">升级</button><button onclick="showPage(0);" class="button">关闭</button></div></div><div class="memory panle"><div class="dashborad config_item"><div class="caption">存储位号</div><div><label>存储位号</label><input id="memoryEditId" type="number" value="0" min="1" max="255" step="1" required /></div><div><label>频率名称</label><input id="memoryEditFreq" type="number" value="0" min="1" max="55" step="0.001" required /></div><button onclick="ws.setMemoryFreq();showPage(0);" class="button">保存</button><button onclick="showPage(0);" class="button">关闭</button></div></div><div class="statics">&#x2191;发送数据: <span id="staticSend">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&#x2193;接收数据: <span id="staticRecv">0</span></div><div id="bubble" class="bubble"></div><div id="modal" class="modal"><div class="modal-content" id="modalContent"></div><button class="close-button" onclick="closeModal()">关闭</button></div><script>var D_RELAY_MIN = 0;var D_RELAY_MAX = 127;var relayC = 0;var relayL = 0;var relaySW = 0;var memoryID = 0;var memoryJson = {};var drawerActive = false;var swrValue = document.getElementById("swrValue");var pwrValue = document.getElementById("fwdValue");var indValue = document.getElementById("indValue");var capValue = document.getElementById("capValue");var swValue = document.getElementById("swValue");var memoryId = document.getElementById("memoryId");var memoryFreq = document.getElementById("memoryFreq");var memoryEditId = document.getElementById("memoryEditId");var memoryEditFreq = document.getElementById("memoryEditFreq");var staticSend = document.getElementById("staticSend");var staticRecv = document.getElementById("staticRecv");var statusDot = document.getElementById("statusDot");var bubble = document.getElementById("bubble");var tuneStatus = document.getElementById("tuneStatus");var tuneMode = document.getElementById("tuneMode");var version = document.getElementById("version");var apName = document.getElementById("apName");var apPass = document.getElementById("apPass");var routeName = document.getElementById("routeName");var routePass = document.getElementById("routePass");var firmwareOnline = document.getElementById("firmware_online");var firmwareDesc = document.getElementById("firmware_desc");var modalContent = document.getElementById('modalContent');var modalContentInit = false;function sync(){ws.sync();showBubble("发送同步所有数据指令！",true);}function saveMemoryJson() {ws.sync();showBubble("请稍等,正在同步数据...", true);setTimeout(function(){if (!Object.keys(memoryJson).length) {showBubble("无可保存的数据！",true);;return;}const a = document.createElement('a');a.href = URL.createObjectURL(new Blob([JSON.stringify(memoryJson)], { type: 'application/json' }));a.download = "存储位备份.json";a.click();},2000);}function resumeMemoryJson() {const input = document.createElement('input');input.type = 'file';input.accept = '.json';input.onchange = async e => {const file = e.target.files[0];if (!file) {showBubble("未选择文件！", true);;return;}try {const dt = JSON.parse(await file.text());let count = Object.keys(dt).length;if (!count) {showBubble("文件内容为空！", true);;return;}Object.values(dt).forEach(v=>{ws.setMemory(v.id, v.sw,v.ind, v.cap, v.freq);});showBubble(`合并恢复成功${count}条！`, true);}catch{showBubble("文件解析失败！", true);}};input.click();}function getRouteList() {showBubble("正在扫描附近路由...", false);fetch('/getRouteList').then(r => {if (!r.ok) throw new Error("网络错误");;return r.json();}).then(d => {const list = document.getElementById('routeList');list.replaceChildren(...d.map(r => Object.assign(document.createElement('option'), {value: r, textContent: r})));showBubble(`自动扫描到附近${d.length}个路由！`, true);}).catch(err => {showBubble("扫描路由失败，请手动输入!", true);});}function openModal() {document.getElementById('modal').style.display = 'block';}function closeModal() {document.getElementById('modal').style.display = 'none';}function createMemoryButton(count, index) {if (modalContent.querySelectorAll("button").length == count) {setMemoryIndex(index);;return;}modalContent.innerHTML = "";for (let i = 0; i < count; i++) {const button = document.createElement('button');button.className = (i == index) ? 'memory-button active' : 'memory-button';button.innerHTML = `<div>M${i + 1}</div><div class='info'>-</div>`;button.onclick = () => {let style = window.getComputedStyle(document.getElementsByClassName("close-button")[0]);if (style.display == "block") {closeModal();}ws.setMemoryId(i + 1);};modalContent.appendChild(button);}}function setMemoryIndex(index) {modalContent.querySelectorAll('.active').forEach(div => { div.classList.remove('active'); });const current = modalContent.children[index];if (current) {current.classList.add('active');}}function setMemoryIndexInfo(index, L, C, Freq) {let txt = '';if (L != 0 || C != 0 || Freq>0) {txt = `${Freq}Mhz ${L}uH ${C}pF`;}modalContent.getElementsByTagName('button')[index - 1].querySelector('.info').innerText = txt;}function setActiveButton(actionParent, status) {const buttons = actionParent.querySelectorAll("button");buttons.forEach(button => {button.classList.remove('active');});if (status >= 0) {buttons[status].classList.add('active');}}function showBubble(message, ishide = true) {bubble.innerText = message;bubble.classList.add("show");if (ishide) {setTimeout(() => {bubble.classList.remove("show");}, 3000);}}function showPage(index) {let panels = document.getElementsByClassName('panle');for (let i = 0; i < panels.length; i++) {panels[i].style.display = i === index ? 'block' : 'none';}}async function getFirmware() {fetch("http://cn.antuner.com/firmware/list.php?ota=true&id=ATR-1000").then(res => res.json()).then(data => {const firmware = data.firmware;var opts = '';for (let key in firmware) {const item = firmware[key];opts += `<option value="${key}">${item.version} (${item.builddate})</option>`;}firmwareOnline.innerHTML = opts;const firstKey = Object.keys(firmware)[0];firmwareDesc.value =`【版本编号】${firmware[firstKey].version}\n【编译日期】${firmware[firstKey].builddate}\n【升级内容】\n${firmware[firstKey].desc}`;firmwareOnline.onchange = function () {const selected = firmware[this.value];firmwareDesc.value =`【版本编号】${selected.version}\n【编译日期】${selected.builddate}\n【升级内容】\n${selected.desc}`;};}).catch(err => console.error(err));}function uploadFirmware(typeId) {function processBuffer(buf) {let b = new Uint8Array(buf);let hlen = parseInt(new TextDecoder().decode(b.slice(0, 10)).replace(/\0/g, "").trim());let offset = 10 + hlen;let header = atob(new TextDecoder().decode(b.slice(10, offset)));let files = header.split("|");for (let i = 0; i < files.length; i++) {let [name, sizeStr] = files[i].split(",");let size = parseInt(sizeStr);if (name === "2") {let data = b.slice(offset, offset + size);for (let j = 0; j < data.length; j++) data[j] ^= 0xFF;let d = new FormData();d.append('update', new Blob([data]), "tmp.bin");let x = new XMLHttpRequest();x.open('POST', '/update');x.upload.onprogress = e => showBubble(`上传进度 ${(e.loaded / e.total * 100).toFixed(1)}%`, false);x.onerror = () => showBubble("上传失败，请检查网络或设备连接");x.onload = () => {if (x.responseText.trim() === "success") {showBubble("设备即将重启，请稍后重新访问本页面...");setTimeout(() => location.reload(), 10000);} else {showBubble("升级失败!");}};x.send(d);showBubble("即将升级");;return;}offset += size;}showBubble("未找到名为固件文件！");}if (typeId === 0) {const version = firmwareOnline.value;if (version == undefined) {showBubble("请先选择正确的固件文件！");;return;}showBubble("正在从官网下载固件，请稍后...", false);fetch(`http://cn.antuner.com/firmware/download.php?id=ATR-1000&file=${version}.hex`).then(res => res.arrayBuffer()).then(buf => processBuffer(buf)).catch(err => showBubble("下载失败：" + err));} else {let input = document.getElementById('firmware_file');if (!input.files.length) {showBubble("请先选择正确的固件文件！");;return;}let reader = new FileReader();reader.onload = function () {processBuffer(reader.result);};reader.readAsArrayBuffer(input.files[0]);}}const SCMD_FLAG = 0xFF;const SCMD_SYNC = 0;const SCMD_METER = 1;const SCMD_TUNE = 2;const SCMD_TUNEMODE = 3;const SCMD_RELAY = 4;const SCMD_MEMORY = 5;const SCMD_MEMORYSTATUS = 6;const SCMD_MEMORYID = 7;const SCMD_ACTIONMEMORY = 8;const SCMD_SETMEMORYFREQ = 9;const SCMD_WIFI = 10;const SCMD_WIFIRESET = 11;const SCMD_SYSTEM = 12;class WS {constructor(url) {this.url = url;this.socket = null;this.reconnectInterval = 2000;this.isConnected = false;this.lastReceivedTime = Date.now();this.sendpack = 0;this.recvpack = 0;this.connect();}connect() {try{this.socket = new WebSocket(this.url);this.socket.binaryType = 'arraybuffer';}catch{;return;}this.socket.onopen = () => {this.isConnected = true;this.updateStatus(true);showBubble("连接成功!");this.checkTimeout();};this.socket.onclose = () => {this.isConnected = false;this.updateStatus(false);showBubble("已经断开，尝试连接...");this.reconnect();};this.socket.onerror = (error) => {showBubble("连接失败:" + error);};this.socket.onmessage = (event) => {this.handleMessage(event.data);};}close() {this.socket.close();}checkTimeout() {setInterval(() => {if (Date.now() - this.lastReceivedTime > self.reconnectInterval) {swrValue.innerText = '-';pwrValue.innerText = '-';}}, self.reconnectInterva);}reconnect() {this.sendpack = 0;this.recvpack = 0;swrValue.innerText = '-';pwrValue.innerText = '-';indValue.innerText = '-';capValue.innerText = '-';memoryId.innerText = '-';memoryEditId.value = 0;memoryEditFreq.value = 0.000;memoryFreq.innerText = '-';swValue.innerText = '-';setTimeout(() => {this.connect();}, this.reconnectInterval);}updateStatus(isConnected) {statusDot.style.backgroundColor = isConnected ? "#64BB5C" : "#E84026";statusDot.innerText = isConnected ? "已连接" : "断开";}handleMessage(data) {const arrayBuffer = data;const dataView = new DataView(arrayBuffer);const flag = dataView.getUint8(0);const cmd = dataView.getUint8(1);switch (cmd) {case SCMD_TUNEMODE:this.parseSTuneMode(dataView);break;case SCMD_METER:this.parseSMeter(dataView);break;case SCMD_RELAY:this.parseSRelay(dataView);break;case SCMD_MEMORY:this.parseSMemory(dataView);break;case SCMD_MEMORYSTATUS:this.parseSMemoryStatus(dataView);break;case SCMD_WIFI:this.parseSWifi(dataView);break;case SCMD_SYSTEM:this.parseSSystem(dataView);break;}this.recvpack++;staticRecv.innerText = this.recvpack;}parseSTuneMode(dataView) {const tuneData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),mode: dataView.getUint8(2)};setActiveButton(tuneMode, tuneData.mode);}parseSMemoryStatus(dataView) {const statusData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),id: dataView.getUint8(2),maxCount: dataView.getUint8(3),freq: (dataView.getUint16(4, true) * 0.001).toFixed(3)};memoryId.innerText = statusData.id == 0 ? '-' : `M${statusData.id}`;memoryFreq.innerText = statusData.id == 0 || statusData.freq == 0 ? '-' : `${statusData.freq}`;memoryEditId.value = statusData.id;memoryEditId.max = String(statusData.maxCount);memoryEditFreq.value = statusData.freq;if (!modalContentInit) {modalContentInit = true;createMemoryButton(statusData.maxCount, statusData.id);}setMemoryIndex(statusData.id - 1);memoryID = statusData.id;}parseSMemory(dataView) {const meterData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),ind: dataView.getUint8(2),cap: dataView.getUint8(3),L: dataView.getUint16(4, true) * 0.001,C: dataView.getUint16(6, true),Freq: parseFloat((dataView.getUint16(8, true) * 0.001).toFixed(3)),sw: dataView.getUint8(10),id: dataView.getUint8(11)};setMemoryIndexInfo(meterData.id, meterData.L, meterData.C, meterData.Freq);if (meterData.L > 0 || meterData.C > 0 || meterData.Freq > 0) {memoryJson[meterData.id] = {id: meterData.id,sw:meterData.sw,ind:meterData.ind,cap:meterData.cap,freq: meterData.Freq}}}parseSMeter(dataView) {this.lastReceivedTime = Date.now();const meterData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),swr: dataView.getUint16(2, true),fwd: dataView.getUint16(4, true),maxfwd: dataView.getUint16(6, true)};if (meterData.swr >= 100) {meterData.swr = (meterData.swr / 100).toFixed(2);}swrValue.innerText = meterData.swr;pwrValue.innerText = `${meterData.fwd}w`;}parseSRelay(dataView) {const relayData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),ind: dataView.getUint8(2),cap: dataView.getUint8(3),L: dataView.getUint16(4, true),C: dataView.getUint16(6, true),sw: dataView.getUint8(8)};relaySW = relayData.sw;relayL = relayData.ind;relayC = relayData.cap;relayData.L = relayData.L / 100;indValue.innerText = `${relayData.L}uH`;capValue.innerText = `${relayData.C}pF`;swValue.innerText = relaySW == 0 ? "LC" : "CL";setActiveButton(tuneStatus, relayL > 0 || relayC > 0 ? 1 : 0);}setTune(isTune) {const buffer = new ArrayBuffer(3);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_TUNE);dataView.setUint8(2, isTune);this.send(buffer);}setTuneMode(mode) {const buffer = new ArrayBuffer(3);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_TUNEMODE);dataView.setUint8(2, mode);this.send(buffer);}setRelay(sw, ind, cap) {const buffer = new ArrayBuffer(5);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_RELAY);dataView.setUint8(2, sw);dataView.setUint8(3, ind);dataView.setUint8(4, cap);this.send(buffer);}setWifi() {const buffer = new ArrayBuffer(82);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_WIFI);this.writeString(dataView, 2, apName.value);this.writeString(dataView, 22, apPass.value);this.writeString(dataView, 42, routeName.value);this.writeString(dataView, 62, routePass.value);this.send(buffer);}setMemoryFreq() {const buffer = new ArrayBuffer(7);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_SETMEMORYFREQ);dataView.setUint8(2, parseInt(memoryEditId.value));dataView.setUint16(3, parseInt(parseFloat(memoryEditFreq.value) * 1000), true);this.send(buffer);}parseSWifi(dataView) {const wifiData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),apName: this.readString(dataView, 2),apPass: this.readString(dataView, 22),routeName: this.readString(dataView, 42),routePass: this.readString(dataView, 62)};apName.value = wifiData.apName;apPass.value = wifiData.apPass;routeName.value = wifiData.routeName;routePass.value = wifiData.routePass;}parseSSystem(dataView) {const systemiData = {flag: dataView.getUint8(0),cmd: dataView.getUint8(1),version: this.readString(dataView, 2)};version.innerText = systemiData.version;}writeString(dataView, offset, str, size = 20) {str = str.trim();for (let i = 0; i < size; i++) {let charCode = i < str.length ? str.charCodeAt(i) : 0;dataView.setUint8(offset + i, charCode);}}readString(dataView, offset, size = 20) {let str = "";for (let i = 0; i < size; i++) {let charCode = dataView.getUint8(offset + i);if (charCode === 0) break;str += String.fromCharCode(charCode);};;return str.trim();}setWifiReset() {const buffer = new ArrayBuffer(2);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_WIFIRESET);this.send(buffer);}setRelayButton(source, action) {if (source == "C") {relayC += action;if (relayC < D_RELAY_MIN) {relayC = D_RELAY_MIN;}else if (relayC >= D_RELAY_MAX) {relayC = D_RELAY_MAX;}}else if (source == "L") {relayL += action;if (relayL < D_RELAY_MIN) {relayL = D_RELAY_MIN;}else if (relayL >= D_RELAY_MAX) {relayL = D_RELAY_MAX;}}else if (source == "S") {relaySW = action;}this.setRelay(relaySW, relayL, relayC);}setMemoryId(id) {const buffer = new ArrayBuffer(6);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_MEMORYID);dataView.setUint8(2, id);this.send(buffer);}setActionMemory(action) {const buffer = new ArrayBuffer(6);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_ACTIONMEMORY);dataView.setUint8(2, action);this.send(buffer);}setMemory(id,sw,ind,cap,freq){const buffer = new ArrayBuffer(8);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_MEMORY);dataView.setUint8(2, id);dataView.setUint8(3, parseInt(sw));dataView.setUint8(4, parseInt(ind));dataView.setUint8(5, parseInt(cap));dataView.setUint16(6, parseInt(parseFloat(freq) * 1000), true);this.send(buffer);}sync(){const buffer = new ArrayBuffer(2);const dataView = new DataView(buffer);dataView.setUint8(0, SCMD_FLAG);dataView.setUint8(1, SCMD_SYNC);this.send(buffer);}send(buffer) {this.socket.send(buffer);this.sendpack++;staticSend.innerText = this.sendpack;showBubble("发送指令成功！");}}let url = window.location.hostname;let wsUrl = `ws://${url}:81/`;const ws = new WS(wsUrl);</script></body></html>